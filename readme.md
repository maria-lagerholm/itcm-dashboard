# BI Dashboard

This dashboard is designed to provide easy access and visualizations for Åshild's webstore, based on data generated in previous steps in the [ITCM recommendation engine](https://github.com/maria-lagerholm/itcm_recommendation_engine).

The backend is built with FastAPI, turning parquet files into a set of JSON endpoints so the frontend can easily render charts without additional data wrangling. All backend modules are assembled in **main.py**.

To see the frontend in action, open [http://localhost](http://localhost).

The frontend is a Next.js app, organized by country folders such as `app/country/Denmark/`. Each page uses a single `COUNTRY` constant and a few hooks that call the API and prepare fields for charts. All visuals are theme-driven via `app/theme.js`, so changes to colors, typography, spacing, grid lines, or tooltip styles propagate globally. All frontend elements are assembled together in **/app/app/page.jsx**.

You can preview the backend API (including the autogenerated docs) by visiting [http://localhost/api/docs#](http://localhost/api/docs#).

The goal is to rapidly deliver analytics on demand and host the dashboard on a server, making it easily accessible to clients with regular update capability.

This project uses Caddy as a reverse proxy on port 80, routing `/api/*` to FastAPI and all other traffic to the Next.js frontend. This setup means everything is served under one URL (`http://localhost`).

The provided Caddyfile for `:80` (HTTP) does the following:

- Redirects `/api` to `/api/docs` (so that visiting `/api` in the browser opens the Swagger UI)
- Proxies `/openapi.json` and `/docs*` to the FastAPI backend (for Swagger/OpenAPI docs)
- Proxies all `/api/*` requests to the FastAPI backend, stripping the `/api` prefix
- Proxies all other requests to the Next.js frontend

With this configuration, both the API and the frontend are served from a single domain.


The `compose.yaml` file orchestrates the following services to run the complete dashboard stack:

- **api**: Builds and runs the FastAPI backend using the provided Dockerfile in `api/`. It mounts the API code and the `data` directory (read-only), sets the environment to development, and uses Uvicorn for auto-reloading in dev mode.
- **web**: Builds and runs the Next.js frontend app from `web/` with live-reload and hot reloading enabled. Key environment variables are set to connect to the API and configure the development environment. Source files and `node_modules` are mounted for efficient development.
- **proxy**: Uses the Caddy server to listen on port 80 and apply reverse proxy rules as described above. The Caddy configuration is mounted read-only into the container. This makes the dashboard and API available on a single URL.
- **sync**: Runs an Alpine-based cron job container that syncs pre-processed data produced by the recommendation engine (`../itcm_recommendation_engine/data/processed`) to the API's data directory at scheduled times (default: 23:00). Logs are persisted to host for auditing.

All services are set to automatically restart unless stopped, ensuring resilience and easy restarts. Simply run:

```
docker compose up -d --build
```

to build and start the stack.



## Structure

```
itcm-dashboard/
├─ api/                  # FastAPI app (Python)
│  ├─ main.py            # app + router includes
│  ├─ deps.py            # loads customers.csv (cached)
│  └─ routers/
│     ├─ countries.py    # GET /api/countries → customers by country
│     └─ country_top_cities.py  # GET /api/country/{id}/top-cities
├─ web/                  # Next.js app (React)
│  ├─ app/               # App Router pages
│  │  ├─ layout.jsx
│  │  ├─ page.jsx        # overview chart
│  │  └─ country/...     # drill-down pages
│  └─ app/theme.js       # chart colors/sizes
├─ data/                 # CSVs (mounted read-only into API)
└─ compose.yaml          # runs api (8000) + web (3000)
```

